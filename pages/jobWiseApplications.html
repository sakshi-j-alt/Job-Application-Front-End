<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job-wise Applicants Table</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f8f9fa;
      }
      .table-container {
        max-width: 1100px;
        margin: 40px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
        padding: 32px;
      }
      .badge {
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <h2 class="mb-4 text-center">Job-wise Applicants</h2>
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Job Title</th>
            <th>Applicant ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Contact</th>
            <th>Gender</th>
            <th>Age</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="applications-tbody">
          <!-- Rows will be populated by JS -->
        </tbody>
      </table>
    </div>

    <script>
      (function () {
        
        const tbody = document.getElementById("applications-tbody");

        function renderJobs(jobs) {
          tbody.innerHTML = ""; // Clear previous rows
          jobs.forEach((job) => {
            job.applicants.forEach((app, idx) => {
              const tr = document.createElement("tr");
              if (idx === 0) {
                tr.innerHTML += `<td rowspan="${job.applicants.length}" class="fw-bold">${job.title}</td>`;
              }
              tr.innerHTML += `
          <td>${app.userId}</td>
          <td>${app.userName}</td>
          <td>${app.email}</td>
          <td>${app.contact}</td>
          <td>${app.gender}</td>
          <td>${app.age}</td>
          <td>
            <span class="badge ${
              app.status === "Selected" ? "bg-success" : "bg-danger"
            }">
              ${app.status}
            </span>
          </td>
        `;
              tbody.appendChild(tr);
            });
          });
        }

        // Fetch jobs and applicants from backend
        fetch(`${baseUrl}/api/job-applicants`)
          .then((res) => res.json())
          .then((jobs) => renderJobs(jobs))
          .catch((err) => {
            tbody.innerHTML = `<tr><td colspan="8" class="text-danger text-center">Failed to load data.</td></tr>`;
            console.error("Error fetching job applicants:", err);
          });
      })();
    </script>
  </body>
</html>

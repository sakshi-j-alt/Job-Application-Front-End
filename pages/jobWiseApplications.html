
    <style>
      body {
        background: #f8f9fa;
      }
      .table-container {
        max-width: 1100px;
        margin: 40px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
        padding: 32px;
      }
      .badge {
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <div class="table-container">
      <h2 class="mb-4 text-center">Job-wise Applicants</h2>
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Job Title</th>
              <th>Application ID</th>
              <th>Applied Date</th>
              <th>Status</th>
              <th>Company</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody id="applications-tbody">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      const applicationsUrl = `${baseUrl}/api/application`;
      const companiesUrl = `${baseUrl}/api/companies`;

      async function loadData() {
        const tbody = document.getElementById("applications-tbody");

        try {
          const [appRes, compRes] = await Promise.all([
            fetch(applicationsUrl,{
          headers: {
            "Content-Type": "application/json",
            Authorization: getAuthorization(),
          },
        }),
            fetch(companiesUrl,{
          headers: {
            "Content-Type": "application/json",
            Authorization: getAuthorization(),
          },
        }),
          ]);

          const applications = await appRes.json();
          const companies = await compRes.json();

          const appMap = {};
          applications.forEach((a) => {
            appMap[a.applicationId] = a;
          });

          tbody.innerHTML = "";

          companies.forEach((company) => {
            (company.jobs || []).forEach((job) => {
              const jobApplications = job.applications || [];
              jobApplications.forEach((jobApp, index) => {
                const detailedApp = appMap[jobApp.applicationId];

                if (!detailedApp) return; // skip if not found

                const tr = document.createElement("tr");

                if (index === 0) {
                  tr.innerHTML += `
                    <td rowspan="${jobApplications.length}" class="fw-bold">
                      ${job.jobTitle}
                    </td>
                  `;
                }

                tr.innerHTML += `
                  <td>${jobApp.applicationId}</td>
                  <td>${detailedApp.appliedDate}</td>
                  <td><span class="badge ${
                    detailedApp.status === "Applied"
                      ? "bg-warning text-dark"
                      : detailedApp.status === "Selected"
                      ? "bg-success"
                      : "bg-danger"
                  }">${detailedApp.status}</span></td>
                  <td>${company.companyName}</td>
                  <td>${job.jobLocation}</td>
                `;

                tbody.appendChild(tr);
              });
            });
          });
        } catch (error) {
          console.error("Error loading data:", error);
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center text-danger">Failed to load data</td>
            </tr>
          `;
        }
      }

      loadData();
    </script>
  </body>

